<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BerryCrepe Bingo!</title>
</head>

<body>
<div class="center">
<table class="card card_head">
<tr><td><div>B</div></td> <td><div>E</div></td> <td><div>R</div></td> <td><div>R</div></td> <td><div>Y</div></td></tr>
<tr><td><div>C</div></td> <td><div>R</div></td> <td><div>E</div></td> <td><div>P</div></td> <td><div>E</div></td></tr>
<tr><td><div>B</div></td> <td><div>I</div></td> <td><div>N</div></td> <td><div>G</div></td> <td><div>O</div></td></tr>
</table>
</div>

<div class="center">
<div class="square">
<table class="sq_content card card_body">
<!-- here goes our data! -->
</table>
</div>
</div>
</body>
<script>
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

const bingo_size = 5;
const bingo_num_cells = bingo_size * bingo_size;
function assert(cond, msg) {
    if (!cond) {
        throw msg;
    }
}

function shuffle(array) {
    let currentIndex = array.length;
    while (0 !== currentIndex) {

        // Pick a remaining element...
        let randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex -= 1;

        // And swap it with the current element.
        let temporaryValue = array[currentIndex];
        array[currentIndex] = array[randomIndex];
        array[randomIndex] = temporaryValue;
    }
}

function clicked_td(i, j) {
    console.log(`Clicked td ${i},${j}`);
}

function gen_table(table, strings) {
    // let thead = table.createTHead();
    let cell = 0;
    for (let i = 0; i < bingo_size; ++i) {
        let row = table.insertRow();
        for (let j = 0; j < bingo_size; ++j) {
            let td = document.createElement("td");
            let div = document.createElement("div");
            let text = document.createTextNode(strings[cell]);

            td.setAttribute("onclick", `clicked_td(${i}, ${j})`);
            div.setAttribute("class", "cell");

            div.appendChild(text);
            td.appendChild(div);
            row.appendChild(td);

            ++cell;
        }
    }
}

const cells_data = [
    '"I just spit everywhere, I\'m so spitty"',
    '"I don\'t know how to explain it"',
    '"I\'m gonna get in trouble"',
    '"Popeyes called me stupid"',
    '"I don\'t know what we\'re doing tomorrow"',
    '"Feet aren\'t free"',
    '"It\'s not a vape"',
    '"I signed the DARE contract"',
    '"I hope my dad isn\'t watching"',
    '"It\'s not that bad"',
    '"Do I have a coomer chat?"',
    '"I\'ve been yelling a lot less, I used to be worse"',

    'Talks about cartoon animals with sexual energy',
    'Talks about how great Buc-ee\'s is"',
    'Abuses Koby',
    [
        'Tells chat to stop talking about cum',
        'Talks about cum',
    ],
    'Asks chat if she\'s allowed to pee',
    'Any sentence of two words or more repeated three times or more in a row',
    'Technical difficulties',
    [
        'Mentions someone pissing their pants',
        'Mentions someone shitting their pants',
    ],
    'Plugs the YouTube channel',
    'Talks shit about DS2 or DS2 viewers',
    [
        'Ironically promotes incest',
        'Unironically denounces incest',
    ],
    'Says "PUSSY" in an odd, high-pitched voice',
];

let strings = [];
{
    let remaining = [...cells_data];
    while (strings.length < bingo_num_cells) {
        if (remaining.length === 0) {
            // If we don't have enough items, add dupes
            assert(false, "Not enough items");
            remaining = [...cells_data];
        }
        let index = Math.floor(Math.random() * remaining.length);
        let chosen = remaining[index];
        if (typeof(chosen) === "string") {
            strings.push(chosen);
        } else {
            for (let elem of chosen) {
                strings.push(elem);
            }
        }
        remaining.splice(index, 1);
    }
}
shuffle(strings);

let table = document.querySelector(".card_body");
gen_table(table, strings);
// TODO:
//  margins/padding in table cells
//  Fix vertical alignment in table cells
//  Font, colours
//  Click on boxes for X
//  Auto detect bingo
//  reset button
//  update URL and generate share link on bingo
//  The css is way better now but we really want a way to force the table
//      cells to stay square instead of stretching vertically. Should be doable.

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
</script>

<style>
    .square {
        position: relative;
        width: 80vmin;
    }
    .card_head {
        width: 80vmin;
    }
    .square:after {
        content: "";
        display: block;
        padding-bottom: 100%;
    }
    .sq_content {
        position: absolute;
        width: 100%;
        height: 100%;
    }
    .center {
        display: flex;
        justify-content: center;
    }
    td div {
        text-align: center;
    }
    .card {
        font-family: Arial, Helvetica, sans-serif;
    }
    .card_head td {
        padding: 5px;
        font-weight: bold;
    }
    .card_body {
        border-collapse: collapse;
    }
    .card_body td {
        //background-color: coral;
        border: 3px solid black;
        width: 20%;
        height: 20%;
    }
</style>
</html>
